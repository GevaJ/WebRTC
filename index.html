<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ghost Tor-Relay</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Courier New', monospace; background: #000; color: #0f0; height: 100dvh; display: flex; flex-direction: column; margin: 0; overflow: hidden; }
        header { background: #111; padding: 10px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .timer { color: red; font-weight: bold; font-size: 0.9rem; }
        .panic-btn { background: #d00; color: white; border: none; padding: 8px 12px; font-weight: bold; border-radius: 4px; }
        .config-area { background: #050505; padding: 10px; border-bottom: 1px solid #222; display: flex; flex-direction: column; gap: 10px; }
        input { background: #000; color: #0f0; border: 1px solid #444; padding: 12px; font-size: 16px; border-radius: 4px; outline: none; }
        ::placeholder { color: #00ff00; opacity: 0.6; }
        #chat { flex: 1; overflow-y: auto; padding: 15px; background: #000; }
        footer { padding: 10px; background: #111; border-top: 1px solid #333; display: flex; gap: 5px; }
        .btn { background: #111; color: #0f0; border: 1px solid #0f0; padding: 10px; font-weight: bold; border-radius: 4px; cursor: pointer; }
        .send-btn { background: #0f0; color: #000; border: none; padding: 0 20px; }
        .sys { color: #555; font-size: 0.8em; margin-bottom: 5px; }
    </style>
</head>
<body>

<header>
    <div id="status" class="timer">OFFLINE</div>
    <button class="panic-btn" onclick="triggerPanic()">⚠ WIPE</button>
</header>

<div class="config-area">
    <div style="display:flex; justify-content:space-between; align-items:center; background:#151515; padding:8px; border:1px solid #333;">
        <span>ROOM: <strong id="room-display" style="color:#fff">...</strong></span>
        <button onclick="copyRoom()" class="btn" style="padding:2px 8px; font-size:0.8rem;">COPY</button>
    </div>
    <input type="password" id="key-input" placeholder="AES PASSWORD">
    <div style="display:flex; gap:5px;">
        <input type="text" id="join-room" placeholder="JOIN ROOM ID">
        <button onclick="initRelay()" class="btn">CONNECT</button>
    </div>
</div>

<div id="chat"><div class="sys">> SYSTEM: RELAY MODE. Enter key and Connect.</div></div>

<footer>
    <input type="text" id="msg-input" placeholder="Type /clear or message..." style="flex:1" autocomplete="off">
    <button class="send-btn btn" onclick="sendMsg()">SEND</button>
</footer>

<script>
    let socket;
    let currentRoom = Math.random().toString(36).substring(2, 6).toUpperCase();
    let timerStarted = false;
    document.getElementById('room-display').innerText = currentRoom;

    function initRelay() {
        const join = document.getElementById('join-room').value.toUpperCase();
        if(join) currentRoom = join;
        
        // שימוש בשרת WebSocket ממסר ציבורי (לא דורש אישור WebRTC)
        socket = new WebSocket('wss://socketsbay.com/wss/v2/1/' + currentRoom + '/');

        socket.onopen = () => {
            appendMsg("SYSTEM", "LINKED TO RELAY: " + currentRoom);
            document.getElementById('status').innerText = "SECURE";
            startTimer();
        };

        socket.onmessage = (e) => {
            try {
                const data = JSON.parse(e.data);
                if(data.type === 'panic') location.reload();
                if(data.type === 'msg') {
                    const key = document.getElementById('key-input').value;
                    const b = CryptoJS.AES.decrypt(data.payload, key);
                    const txt = b.toString(CryptoJS.enc.Utf8);
                    if(txt) {
                        appendMsg("GHOST", txt);
                        playHackerSound();
                    }
                }
            } catch(err) {}
        };
    }

    function sendMsg() {
        const input = document.getElementById('msg-input');
        const key = document.getElementById('key-input').value;
        if(input.value === '/clear') { document.getElementById('chat').innerHTML = ''; input.value = ''; return; }
        if(!key || !input.value || !socket) return;

        const enc = CryptoJS.AES.encrypt(input.value, key).toString();
        socket.send(JSON.stringify({ type: 'msg', payload: enc }));
        appendMsg("YOU", input.value);
        input.value = "";
    }

    function appendMsg(s, t) {
        const chat = document.getElementById('chat');
        const d = document.createElement('div');
        const color = s === 'YOU' ? '#0f0' : (s === 'SYSTEM' ? '#555' : '#00bcd4');
        d.innerHTML = `<strong style="color:${color}">${s}:</strong> ${t}`;
        chat.appendChild(d); chat.scrollTop = chat.scrollHeight;
    }

    function triggerPanic() {
        if(socket) socket.send(JSON.stringify({ type: 'panic' }));
        setTimeout(() => location.reload(), 500);
    }

    function startTimer() {
        if(timerStarted) return; timerStarted = true;
        let tl = 30 * 60;
        setInterval(() => {
            let m = Math.floor(tl / 60), s = tl % 60;
            document.getElementById('status').innerText = `WIPE: ${m}:${s<10?'0':''}${s}`;
            if(tl-- <= 0) location.reload();
        }, 1000);
    }

    function playHackerSound() {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'square'; o.frequency.setValueAtTime(1200, ctx.currentTime);
        g.gain.setValueAtTime(0.05, ctx.currentTime);
        o.connect(g); g.connect(ctx.destination);
        o.start(); o.stop(ctx.currentTime + 0.1);
    }

    function copyRoom() {
        navigator.clipboard.writeText(currentRoom);
    }

    document.getElementById('msg-input').addEventListener('keypress', e => { if(e.key==='Enter') sendMsg(); });
</script>
</body>
</html>
