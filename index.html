<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tor-Secure Ghost Chat</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <style>
        * { box-sizing: border-box; font-family: 'Courier New', monospace; }
        body { background: #000; color: #0f0; height: 100dvh; display: flex; flex-direction: column; margin: 0; overflow: hidden; }
        header { background: #111; padding: 10px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .timer { color: red; font-weight: bold; }
        .panic-btn { background: #d00; color: #fff; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        #chat { flex: 1; overflow-y: auto; padding: 15px; }
        .config { background: #050505; padding: 10px; border-bottom: 1px solid #222; display: flex; flex-direction: column; gap: 10px; }
        input { background: #000; color: #0f0; border: 1px solid #444; padding: 12px; font-size: 16px; border-radius: 4px; outline: none; }
        ::placeholder { color: #00ff00; opacity: 0.7; }
        footer { padding: 10px; background: #111; border-top: 1px solid #333; display: flex; gap: 5px; }
        .send-btn { background: #0f0; color: #000; border: none; padding: 0 20px; font-weight: bold; border-radius: 4px; }
        .msg { margin-bottom: 10px; }
        .sys { color: #555; font-size: 0.8em; }
    </style>
</head>
<body>

<header>
    <div id="status" class="timer">OFFLINE</div>
    <button class="panic-btn" onclick="wipe()">⚠ NUCLEAR WIPE</button>
</header>

<div class="config">
    <div style="display:flex; justify-content:space-between; background:#111; padding:10px; border:1px solid #333;">
        <span>ROOM ID: <strong id="room-display" style="color:#fff">...</strong></span>
        <button onclick="copyId()" style="background:#0f0; border:none; padding:2px 10px; font-weight:bold; border-radius:3px;">COPY</button>
    </div>
    <input type="password" id="key" placeholder="AES PASSWORD KEY">
    <input type="text" id="join-room" placeholder="ENTER ROOM ID TO JOIN">
    <button onclick="initConnection()" style="background:#111; color:#0f0; border:1px solid #0f0; padding:10px; font-weight:bold;">ESTABLISH LINK</button>
</div>

<div id="chat">
    <div class="sys">> SYSTEM: Tor-compatible mode active. Enter password and Link.</div>
</div>

<footer>
    <input type="text" id="input" placeholder="Secure transmit..." style="flex:1" autocomplete="off">
    <button class="send-btn" onclick="send()">SEND</button>
</footer>

<script>
    // הגדרת שרת ממסר ציבורי חינמי (בשימוש זמני לצורך הדגמה - בייצור מומלץ להריץ שרת פרטי)
    let socket;
    let roomId = Math.random().toString(36).substring(2, 6).toUpperCase();
    document.getElementById('room-display').innerText = roomId;

    function initConnection() {
        const target = document.getElementById('join-room').value.toUpperCase();
        if(target) roomId = target;
        
        // שימוש בשרת WebSocket ממסר (Tor לא חוסם את זה)
        socket = new WebSocket('wss://socketsbay.com/wss/v2/1/' + roomId + '/');

        socket.onopen = () => {
            appendMsg("SYSTEM", "RELAY LINK ESTABLISHED ON ROOM: " + roomId);
            document.getElementById('status').innerText = "LINKED";
            startTimer();
        };

        socket.onmessage = (e) => {
            const data = JSON.parse(e.data);
            if(data.type === 'panic') wipe();
            if(data.type === 'msg') {
                const key = document.getElementById('key').value;
                const b = CryptoJS.AES.decrypt(data.payload, key);
                const txt = b.toString(CryptoJS.enc.Utf8);
                if(txt) {
                    appendMsg("GHOST", txt);
                    playHackerSound();
                }
            }
        };
    }

    function send() {
        const input = document.getElementById('input');
        const key = document.getElementById('key').value;
        if(!key || !input.value || !socket) return;

        const enc = CryptoJS.AES.encrypt(input.value, key).toString();
        socket.send(JSON.stringify({ type: 'msg', payload: enc }));
        appendMsg("YOU", input.value);
        input.value = "";
    }

    function appendMsg(s, t) {
        const c = document.getElementById('chat');
        const d = document.createElement('div');
        d.className = 'msg';
        d.innerHTML = `<strong style="color:${s === 'YOU' ? '#0f0' : '#00bcd4'}">${s}:</strong> ${t}`;
        c.appendChild(d);
        c.scrollTop = c.scrollHeight;
    }

    function wipe() {
        if(socket) socket.send(JSON.stringify({ type: 'panic' }));
        setTimeout(() => location.reload(), 500);
    }

    function startTimer() {
        let tl = 30 * 60;
        setInterval(() => {
            let m = Math.floor(tl / 60), s = tl % 60;
            document.getElementById('status').innerText = `WIPE: ${m}:${s<10?'0':''}${s}`;
            if(tl-- <= 0) location.reload();
        }, 1000);
    }

    function playHackerSound() {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'square'; o.frequency.setValueAtTime(1500, ctx.currentTime);
        g.gain.setValueAtTime(0.05, ctx.currentTime);
        o.connect(g); g.connect(ctx.destination);
        o.start(); o.stop(ctx.currentTime + 0.1);
    }

    function copyId() {
        navigator.clipboard.writeText(roomId);
    }

    document.getElementById('input').addEventListener('keypress', e => { if(e.key==='Enter') send(); });
</script>
</body>
</html>
